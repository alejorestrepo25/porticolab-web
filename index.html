<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PORTICO LAB</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="iconos/favicon.ico" type="image/ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
<header>
  <a href="index.html" class="logo">PORTICO_LAB</a>

  <nav class="nav">
    <a href="laboratorio.html">LABORATORIO</a>
    <a href="inspiracion.html">INSPIRACIÓN</a>
    <a href="nosotros.html">NOSOTROS</a>
  </nav>
</header>

<main>
  <section class="gallery"></section>
</main>

<script>
  console.log("SCRIPT DE INDEX CARGADO");
  
  document.addEventListener("DOMContentLoaded", async () => {
    console.log("DOM LISTO");

    const gallery = document.querySelector(".gallery");
    if (!gallery) return;

    // Lista de posts
    const posts = [1,2,3,4,5,6,7,8,9];
    const items = [];

    for (const id of posts) {
      try {
        // ✅ CORREGIDO: Usar la estructura "post (1)", "post (2)", etc.
        const postFolder = `post (${id})`;
        console.log(`Intentando cargar: publicaciones/${postFolder}/data.json`);
        
        const res = await fetch(`publicaciones/${postFolder}/data.json`);
        
        if (!res.ok) {
          console.warn(`❌ Post (${id}) no encontrado (HTTP ${res.status})`);
          continue;
        }

        const data = await res.json();
        console.log(`✅ Post (${id}) cargado:`, data.title);

        const item = document.createElement("div");
        item.className = "gallery-item";
        item.dataset.tags = (data.tags || []).join(",");

        // ✅ CORREGIDO: Codificar espacios como %20 en la URL
        item.innerHTML = `
          <a href="publicaciones/post.html?post=post%20(${id})">
            <img 
              src="publicaciones/${postFolder}/portada.jpg" 
              alt="${data.title || 'Proyecto'}" 
              loading="lazy"
              onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'300\' height=\'250\'%3E%3Crect fill=\'%23222\' width=\'300\' height=\'250\'/%3E%3Ctext x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' fill=\'%23666\' font-size=\'14\' font-family=\'Arial\'%3EImagen no disponible%3C/text%3E%3C/svg%3E'">
          </a>
          <h3>${data.title || 'Proyecto'}</h3>
          <div class="post-tags">
            ${(data.tags || []).map(t => `<span>#${t}</span>`).join("")}
          </div>
        `;

        items.push(item);

      } catch (err) {
        console.error(`❌ Error cargando post (${id}):`, err.message);
      }
    }

    // Mezclar después de crear todo
    shuffle(items);

    // Render final
    items.forEach(item => gallery.appendChild(item));
    gallery.style.columnCount = getComputedStyle(gallery).columnCount;
    
    console.log(`📊 Total de posts cargados: ${items.length} de ${posts.length}`);
    
    if (items.length === 0) {
      gallery.innerHTML = '<div style="text-align:center;padding:60px;color:#666;font-size:18px;">No se encontraron publicaciones.<br><span style="font-size:14px;color:#444;">Verifica que existan las carpetas publicaciones/post (1)/, post (2)/, etc. con sus archivos data.json</span></div>';
    }

    // Función de mezcla
    function shuffle(array) {
      let i = array.length;
      while (i > 0) {
        const j = Math.floor(Math.random() * i--);
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

  });
</script>

</body>
</html>